<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gr.farming.request.model.RequestDAO">	

	<!-- 견적요청서 작성 -->
	<insert id="insertRequest" parameterType="requestVo">
		<selectKey keyProperty="requestNo" resultType="int" order="BEFORE">
			select request_seq.nextval from dual
		</selectKey>
		insert into request(REQUEST_NO, CATEGORY_NO, MEMBER_NO, EXPERT_NO
			, REQUEST_DESIGN_NO, REQUEST_DEVELOP_NO)
		values(#{requestNo}, #{categoryNo}, #{memberNo}, #{expertNo}
			, #{requestDesignNo}, #{requestDevelopNo})
	</insert>

	<insert id="insertRequestDevelop" parameterType="requestDevelopVo">
		<selectKey keyProperty="requestdevelopNo" resultType="int" order="BEFORE">
			select REQUEST_DEVELOP_SEQ.nextval from dual 
		</selectKey>
		insert into request_develop(REQUEST_DEVELOP_NO, PLATFORM, TYPE, CAREER, STEP,
			REFERENCE, DEADLINE, WORKTYPE, LOCATION1, LOCATION2)
		values(#{requestdevelopNo}, #{PLATFORM}, #{TYPE}, #{CAREER}, #{STEP}, 
			#{REFERENCE}, #{DEADLINE}, #{WORKTYPE}, #{LOCATION1}, #{LOCATION2})
	</insert>
	
	<insert id="insertRequestDesign" parameterType="requestDesignVo">
		<selectKey keyProperty="requestDesignNo" resultType="int" order="BEFORE">
			select REQUEST_DESIGN_SEQ.nextval from dual 
		</selectKey>
		insert into request_design(REQUEST_DESIGN_NO, TYPE, RANGE, SCALE,
			DEADLINE, LOCATION1, LOCATION2, QUESTION)
		values(#{requestDesignNo}, #{TYPE}, #{RANGE}, #{SCALE}, 
			#{DEADLINE}, #{LOCATION1}, #{LOCATION2}, #{QUESTION})
	</insert>
	
	<!-- 견적요청서 문답 조회 -->	
	<select id="selectRequestQna" parameterType="requestQnaVo" resultType="requestQnaVo">
		select * from request_qna
		where category_no=#{categoryNo}
		order by a_no
	</select>
	<select id="selectQuestion" parameterType="int" resultType="map">
		select * from REQUEST_QUESTION
		where category_no=#{categoryNo}
	</select>
	<select id="selectAnswer" parameterType="int" resultType="map">
		select * from request_answer
		where q_no=#{qNo}
	</select>
	
	<!-- 전문가회원 - 받은 요청서 목록 조회 -->
	<select id="selectReceivedRequest" parameterType="int" resultType="map">
		select * from requestMember
		where expert_no=#{expertNo}
	</select>
	
	<!-- 전문가회원 - 받은 요청서 각 문답 조회 -->
	<select id="selectRequestDetail" parameterType="int" resultType="map">
		select rm.request_no, rm.category_no, rm.member_no, rm.name, rm.address1,
    		rm.filename, rm.expert_no, rm.send_time, rm.match, d.*
		<if test="requestDesignNo!=null and requestDesignNo!=''">
			from requestmember rm join request_design d
			on rm.request_design_no=d.request_design_no
			where expert_no=#{}
		</if>
		<if test="requestDevelopNo!=null and requestDevelopNo!=''">
			from request r join request_develop d
			on r.request_develop_no=d.request_develop_no
			where d.request_develop_no=#{requestDevelopNo}
		</if>
	</select>
	
</mapper>